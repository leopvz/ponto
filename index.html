<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ponto Papelprint</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white shadow-xl rounded-lg w-full max-w-md p-6">
    <h1 class="text-xl font-bold text-center mb-4">Sistema de Ponto - Papelprint</h1>

    <div id="login-section">
      <label class="block mb-2 text-gray-700 font-medium">Usuário</label>
      <input id="username" type="text" class="w-full border px-4 py-2 rounded mb-4" placeholder="Digite seu nome" />
      <label class="block mb-2 text-gray-700 font-medium">Senha</label>
      <input id="password" type="password" class="w-full border px-4 py-2 rounded mb-4" placeholder="Digite sua senha" />
      <button id="login-btn" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Entrar</button>
    </div>

    <div id="ponto-section" class="hidden">
      <h2 class="text-center text-lg font-semibold mb-2" id="user-welcome"></h2>
      <p class="text-center text-sm text-gray-600 mb-4" id="date-display"></p>
      <button id="ponto-btn" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">Bater Ponto</button>

      <div class="mt-6">
        <h3 class="font-medium text-gray-700 mb-2">Batidas do Dia:</h3>
        <ul id="batidas-list" class="text-sm text-gray-800 space-y-1"></ul>
      </div>

      <div class="mt-4 border-t pt-4">
        <h3 class="font-medium text-gray-700 mb-2">Saldo de Banco de Horas:</h3>
        <p id="saldo-horas" class="text-lg font-semibold"></p>
        <p id="alerta" class="text-sm text-yellow-600 mt-2"></p>
      </div>

      <button id="logout-btn" class="mt-6 w-full bg-red-500 text-white py-2 rounded hover:bg-red-600">Sair</button>
    </div>
  </div>

  <script>
    const users = {
      "Emerson": { senha: "papel12", entrada: "07:30", saida: "17:30", sexta: "16:30" },
      "Flavio": { senha: "papel13", entrada: "07:30", saida: "17:30", sexta: "16:30" },
      "Elias": { senha: "papel14", entrada: "08:00", saida: "18:00", sexta: "17:00" },
    };

    const loginBtn = document.getElementById("login-btn");
    const pontoBtn = document.getElementById("ponto-btn");
    const logoutBtn = document.getElementById("logout-btn");

    const loginSection = document.getElementById("login-section");
    const pontoSection = document.getElementById("ponto-section");
    const usernameInput = document.getElementById("username");
    const passwordInput = document.getElementById("password");
    const userWelcome = document.getElementById("user-welcome");
    const batidasList = document.getElementById("batidas-list");
    const saldoHoras = document.getElementById("saldo-horas");
    const alerta = document.getElementById("alerta");
    const dateDisplay = document.getElementById("date-display");

    let usuarioLogado = null;

    function formatarHora(data) {
      return data.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function carregarBatidas(nome) {
      const dataHoje = new Date().toISOString().split('T')[0];
      const key = `ponto-${nome}-${dataHoje}`;
      const batidas = JSON.parse(localStorage.getItem(key) || "[]");
      return batidas;
    }

    function salvarBatida(nome, hora) {
      const dataHoje = new Date().toISOString().split('T')[0];
      const key = `ponto-${nome}-${dataHoje}`;
      const batidas = JSON.parse(localStorage.getItem(key) || "[]");
      batidas.push(hora);
      localStorage.setItem(key, JSON.stringify(batidas));
    }

    function calcularBanco(nome, batidas) {
      const hoje = new Date();
      const diaSemana = hoje.getDay();
      const ehSexta = diaSemana === 5;

      const entradaEsperada = users[nome].entrada;
      const saidaEsperada = ehSexta ? users[nome].sexta : users[nome].saida;

      if (batidas.length < 4) return { saldo: "--", alerta: "Batidas incompletas." };

      const t1 = new Date(`${hoje.toDateString()} ${batidas[0]}`);
      const t2 = new Date(`${hoje.toDateString()} ${batidas[1]}`);
      const t3 = new Date(`${hoje.toDateString()} ${batidas[2]}`);
      const t4 = new Date(`${hoje.toDateString()} ${batidas[3]}`);

      const trabalho1 = (t2 - t1) / 3600000;
      const trabalho2 = (t4 - t3) / 3600000;
      const total = trabalho1 + trabalho2;

      const entrada = new Date(`${hoje.toDateString()} ${entradaEsperada}`);
      const saida = new Date(`${hoje.toDateString()} ${saidaEsperada}`);
      const carga = (saida - entrada) / 3600000 - 1;

      const diff = total - carga;
      const saldo = diff >= 0 ? `+${diff.toFixed(2)}h` : `${diff.toFixed(2)}h`;

      const intervaloAlmoco = (t3 - t2) / 60000;
      let alertaTexto = "";
      if (intervaloAlmoco < 60) alertaTexto = `⚠️ Almoço inferior a 1h: ${intervaloAlmoco} min`;
      if (intervaloAlmoco > 60) alertaTexto = `⏳ Almoço excedeu 1h: -${(intervaloAlmoco - 60)} min`;

      return { saldo, alerta: alertaTexto };
    }

    loginBtn.onclick = () => {
      const nome = usernameInput.value.trim();
      const senha = passwordInput.value.trim();

      if (users[nome] && users[nome].senha === senha) {
        usuarioLogado = nome;
        loginSection.classList.add("hidden");
        pontoSection.classList.remove("hidden");
        userWelcome.textContent = `Olá, ${nome}`;
        dateDisplay.textContent = new Date().toLocaleDateString("pt-BR", { weekday: "long", day: "2-digit", month: "2-digit" });

        const batidas = carregarBatidas(nome);
        batidasList.innerHTML = batidas.map((h, i) => `<li>${i+1}ª batida: ${h}</li>`).join("");
        const banco = calcularBanco(nome, batidas);
        saldoHoras.textContent = banco.saldo;
        alerta.textContent = banco.alerta;
      } else {
        alert("Usuário ou senha incorretos.");
      }
    };

    pontoBtn.onclick = () => {
      const agora = new Date();
      const hora = formatarHora(agora);
      salvarBatida(usuarioLogado, hora);
      const batidas = carregarBatidas(usuarioLogado);

      batidasList.innerHTML = batidas.map((h, i) => `<li>${i+1}ª batida: ${h}</li>`).join("");
      const banco = calcularBanco(usuarioLogado, batidas);
      saldoHoras.textContent = banco.saldo;
      alerta.textContent = banco.alerta;
    };

    logoutBtn.onclick = () => {
      usuarioLogado = null;
      loginSection.classList.remove("hidden");
      pontoSection.classList.add("hidden");
      usernameInput.value = "";
      passwordInput.value = "";
    };
  </script>
</body>
</html>
